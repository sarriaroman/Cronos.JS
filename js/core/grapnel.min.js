/****
 * Grapnel.js
 * https://github.com/EngineeringMode/Grapnel.js
 *
 * @author Greg Sabia Tucker
 * @link http://artificer.io
 * @version 0.3.1
 *
 * Released under MIT License. See LICENSE.txt or http://opensource.org/licenses/MIT
*/

(function(e){function t(e){"use strict";var t=this;this._actions=[];this._events=[];this.action=null;this.hook=e||":";this.value=null;this.params=[];this.anchor={defaultHash:window.location.hash};this.state=null;this.version="0.3.1";this.add=function(e,n){var r=function(){var r=t.action&&e instanceof RegExp?t.anchor.get().match(e):false;if(r||e===t.action||t.anchor.get()==e){var i={name:e,value:t.anchor.get(),handler:n,params:t.params,regex:r,previousState:t.state};t._trigger("change",i);t._actions.push({name:e,handler:n});t.state=i;n.call(t,t.value,t.params,i)}return t};return r().on(["initialized","hashchange"],r)};this._trigger=function(e){var n=Array.prototype.slice.call(arguments,1);t._forEach(t._events,function(r){if(r.event==e)r.handler.apply(t,n)});return t};this._forEach=function(e,t){if(typeof Array.prototype.forEach==="function")return Array.prototype.forEach.call(e,t);return function(e,t){for(var n=0,r=this.length;n<r;++n){e.call(t,this[n],n,this)}}.call(e,t)};this._routeRegExp=function(e,t,n,r){if(e instanceof RegExp)return e;if(e instanceof Array)e="("+e.join("|")+")";e=e.concat(r?"":"/?").replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(e,n,r,i,s,o){t.push({name:i,optional:!!o});n=n||"";return""+(o?"":n)+"(?:"+(o?n:"")+(r||"")+(s||r&&"([^/.]+?)"||"([^/]+?)")+")"+(o||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)");return new RegExp("^"+e+"$",n?"":"i")};this.anchor.get=function(){return window.location.hash?window.location.hash.split("#")[1]:""};this.anchor.set=function(e){window.location.hash=!e?"":e;return t};this.anchor.clear=function(){return this.set(false)};this.on(["initialized","hashchange"],function(){var e=this.parse();this.action=e.action;this.value=e.value;this.params=e.params;this._actions=[]});if(typeof window.onhashchange==="function")this.on("hashchange",window.onhashchange);window.onhashchange=function(){t._trigger("hashchange")};return this._trigger("initialized")}t.prototype.on=t.prototype.bind=function(e,t){var n=typeof e==="string"?e.split():e,r=this;this._forEach(n,function(e){r._events.push({event:e,handler:t})});return this};t.prototype.parse=function(){var e=this.anchor.get(),t=e.split(this.hook),n=e.match(this.hook),r=t[0],i=[],s;if(this.anchor.get().match(this.hook)){i=t.slice(1);s=i.join(n[0])}var o={pieces:t};this._trigger("parse",o);return{value:s,action:r,params:i}};t.prototype.matches=function(){var e=[],t=this;this._forEach(this._actions,function(n){var r=n.name instanceof RegExp&&t.action.match(n.name);if(r||n.name===t.action){e.push(n)}});return e};t.prototype.router=function(){return t.Router()};t.Router=function(){var e=new t(/\//gi);e.get=function(t,n){var r=[];var i=new this._routeRegExp(t,r);e.add(i,function(t,i,s){var o={params:{},keys:r,matches:s.regex.slice(1)};e._forEach(o.matches,function(e,t){var n=r[t]&&r[t].name?r[t].name:t;o.params[n]=e?decodeURIComponent(e):undefined});n.call(e,o,s)});return e};return e._trigger("initialized")};if("function"===typeof e.define){e.Grapnel=t;e.define(function(e){return t})}else if("object"===typeof exports){exports.Grapnel=t}else{e.Grapnel=t}}).call({},window)
